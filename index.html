
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Documentation for the Django Messages DRF API"
        >
    <title>Django Messages DRF</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-9c19b03a.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-966d6edc.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-1e815a84.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#supported-django-and-python-versions" class="toc-h2 toc-link" data-title="Supported Django and Python Versions">Supported Django and Python Versions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#installing" class="toc-h1 toc-link" data-title="Installing">Installing</a>
          </li>
          <li>
            <a href="#urls" class="toc-h1 toc-link" data-title="URLs">URLs</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#inbox" class="toc-h2 toc-link" data-title="Inbox">Inbox</a>
                  </li>
                  <li>
                    <a href="#list-messages" class="toc-h2 toc-link" data-title="List Messages">List Messages</a>
                  </li>
                  <li>
                    <a href="#send-first-message" class="toc-h2 toc-link" data-title="Send First Message">Send First Message</a>
                  </li>
                  <li>
                    <a href="#expand-on-thread" class="toc-h2 toc-link" data-title="Expand on thread">Expand on thread</a>
                  </li>
                  <li>
                    <a href="#edit-message" class="toc-h2 toc-link" data-title="Edit message">Edit message</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#views" class="toc-h1 toc-link" data-title="Views">Views</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#inboxlistapiview" class="toc-h2 toc-link" data-title="InboxListApiView">InboxListApiView</a>
                  </li>
                  <li>
                    <a href="#threadlistapiview" class="toc-h2 toc-link" data-title="ThreadListApiView">ThreadListApiView</a>
                  </li>
                  <li>
                    <a href="#threadcrudapiview" class="toc-h2 toc-link" data-title="ThreadCRUDApiView">ThreadCRUDApiView</a>
                  </li>
                  <li>
                    <a href="#editmessageapiview" class="toc-h2 toc-link" data-title="EditMessageApiView">EditMessageApiView</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#mixins" class="toc-h1 toc-link" data-title="Mixins">Mixins</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#requireusercontextview" class="toc-h2 toc-link" data-title="RequireUserContextView">RequireUserContextView</a>
                  </li>
                  <li>
                    <a href="#threadmixin" class="toc-h2 toc-link" data-title="ThreadMixin">ThreadMixin</a>
                  </li>
                  <li>
                    <a href="#currentthreaddefault" class="toc-h2 toc-link" data-title="CurrentThreadDefault">CurrentThreadDefault</a>
                  </li>
                  <li>
                    <a href="#examples" class="toc-h2 toc-link" data-title="Examples">Examples</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#models" class="toc-h1 toc-link" data-title="Models">Models</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#thread" class="toc-h2 toc-link" data-title="Thread">Thread</a>
                  </li>
                  <li>
                    <a href="#userthread" class="toc-h2 toc-link" data-title="UserThread">UserThread</a>
                  </li>
                  <li>
                    <a href="#message" class="toc-h2 toc-link" data-title="Message">Message</a>
                  </li>
                  <li>
                    <a href="#tips-4" class="toc-h2 toc-link" data-title="Tips">Tips</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#pagination" class="toc-h1 toc-link" data-title="Pagination">Pagination</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#pagination-class" class="toc-h2 toc-link" data-title="Pagination class">Pagination class</a>
                  </li>
                  <li>
                    <a href="#simplepagination" class="toc-h2 toc-link" data-title="SimplePagination">SimplePagination</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#permissions" class="toc-h1 toc-link" data-title="Permissions">Permissions</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#accessmixin" class="toc-h2 toc-link" data-title="AccessMixin">AccessMixin</a>
                  </li>
                  <li>
                    <a href="#djangomessagedrfauthmixin" class="toc-h2 toc-link" data-title="DjangoMessageDRFAuthMixin">DjangoMessageDRFAuthMixin</a>
                  </li>
                  <li>
                    <a href="#examples-2" class="toc-h2 toc-link" data-title="Examples">Examples</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#serializers" class="toc-h1 toc-link" data-title="Serializers">Serializers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#inbox-2" class="toc-h2 toc-link" data-title="Inbox">Inbox</a>
                  </li>
                  <li>
                    <a href="#sender" class="toc-h2 toc-link" data-title="Sender">Sender</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#serializer-settings" class="toc-h1 toc-link" data-title="Serializer Settings">Serializer Settings</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overriding" class="toc-h2 toc-link" data-title="Overriding">Overriding</a>
                  </li>
                  <li>
                    <a href="#usage" class="toc-h2 toc-link" data-title="Usage">Usage</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#behaviour-settings" class="toc-h1 toc-link" data-title="Behaviour Settings">Behaviour Settings</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overriding-2" class="toc-h2 toc-link" data-title="Overriding">Overriding</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#utils" class="toc-h1 toc-link" data-title="Utils">Utils</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#auditmodel" class="toc-h2 toc-link" data-title="AuditModel">AuditModel</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#signals" class="toc-h1 toc-link" data-title="Signals">Signals</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#message-sent" class="toc-h2 toc-link" data-title="Message sent">Message sent</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#release-notes" class="toc-h1 toc-link" data-title="Release Notes">Release Notes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#1-0-6" class="toc-h2 toc-link" data-title="1.0.6">1.0.6</a>
                  </li>
                  <li>
                    <a href="#1-0-5" class="toc-h2 toc-link" data-title="1.0.5">1.0.5</a>
                  </li>
                  <li>
                    <a href="#1-0-4" class="toc-h2 toc-link" data-title="1.0.4">1.0.4</a>
                  </li>
                  <li>
                    <a href="#1-0-3" class="toc-h2 toc-link" data-title="1.0.3">1.0.3</a>
                  </li>
                  <li>
                    <a href="#1-0-2" class="toc-h2 toc-link" data-title="1.0.2">1.0.2</a>
                  </li>
                  <li>
                    <a href="#1-0-0" class="toc-h2 toc-link" data-title="1.0.0">1.0.0</a>
                  </li>
                  <li>
                    <a href="#license" class="toc-h2 toc-link" data-title="License">License</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a target='_blank' href='https://github.com/docuowl/docuowl/issues/new'>Can we improve it? Tell us</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p><a href="https://circleci.com/gh/tarsil/django-messages-drf"><img src="https://img.shields.io/circleci/project/github/tarsil/django-messages-drf.svg" alt="CircleCi" /></a>
<a href="https://codecov.io/gh/tarsil/django-messages-drf"><img src="https://codecov.io/gh/tarsil/django-messages-drf/branch/master/graph/badge.svg?token=VfTlWQlGeF" alt="codecov" /></a></p>

<p>Django Messages DRF is an alternative and based on pinax-messages but using Django Rest Framework by making it easier to integrate with your existing project. It allows CRUD messages along with inbox and creating threads. Users can reply to messages and mark them as read.</p>

<p>A special thanks to pinax for inspiring me to do this and use some ideas.</p>

<p>Tested, easy to customize, up-to-date with Python 3.10 app that provided private user-to-user threaded messaging.</p>
<h2 id='supported-django-and-python-versions'>Supported Django and Python Versions</h2>
<table><thead>
<tr>
<th>Django / Python</th>
<th>3.6</th>
<th>3.7</th>
<th>3.8</th>
<th>3.9</th>
<th>3.10</th>
</tr>
</thead><tbody>
<tr>
<td>2.2</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>3.0</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>3.1</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>3.2</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>4.0</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody></table>
<h1 id='installing'>Installing</h1>
<blockquote>
<p>In order to install run pip:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>pip <span class="nb">install </span>django_messages_drf
</code></pre></div>
<blockquote>
<p>Then add <code>django_messages_drf</code> to your <code>INSTALLED_APPS</code>:</p>
</blockquote>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1"># ...
</span>  <span class="s">"django_messages_drf"</span><span class="p">,</span>
  <span class="c1"># ...
</span><span class="p">]</span>
</code></pre></div>
<blockquote>
<p>Run Django migrations to create <code>django-messages-drf</code> database tables:</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>python manage.py migrate
</code></pre></div>
<blockquote>
<p>You&#39;ll also want to add <code>django_messages_drf.urls</code> into your main urlpatterns.</p>
</blockquote>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># other urls
</span>    <span class="n">path</span><span class="p">(</span><span class="s">"api/messages-drf/"</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">"django_messages_drf.urls"</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">"django_messages_drf"</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></div>
<blockquote>
<p>Remember to use at least Python 3.6</p>
</blockquote>

<p>Process of installing uses default pip procedure like other django apps.</p>
<h1 id='urls'>URLs</h1><h2 id='overview'>Overview</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="c1"># Change app_name when customizing endpoints in your app
</span><span class="n">app_name</span> <span class="o">=</span> <span class="s">"django_messages_drf"</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'inbox/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">InboxListApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'inbox'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;uuid&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadListApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;user_id&gt;/send/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadCRUDApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread-create'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;uuid&gt;/&lt;user_id&gt;/send/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadCRUDApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread-send'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;user_id&gt;/&lt;thread_id&gt;/edit/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">EditMessageApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'message-edit'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'thread/&lt;uuid&gt;/delete'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadCRUDApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread-delete'</span><span class="p">),</span>
<span class="p">]</span>

</code></pre></div>
<p>App provides 6 endpoints with CRUD functionalities.</p>
<h2 id='inbox'>Inbox</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">path</span><span class="p">(</span><span class="s">'inbox/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">InboxListApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'inbox'</span><span class="p">),</span>
</code></pre></div>
<p>This endpoint retrieves all threads that have been sent to current user (initiated by other users).</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET http://localhost:8000/api/messages-drf/inbox/</code></p>

<aside class="notics">
Remember — this inbox works like Gmail thread functionality
</aside>
<h2 id='list-messages'>List Messages</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;uuid&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadListApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread'</span><span class="p">),</span>
</code></pre></div>
<p>This endpoint retrieves all messages that are within a thread.</p>
<h3 id='route-parameters'>Route Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>true</td>
<td>The UUID of the thread.</td>
</tr>
</tbody></table>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET http://localhost:8000/api/message/thread/&lt;uuid&gt;/</code></p>

<aside class="notics">
User can reply to a message that he recieved. This way he adds to a thread. When a message is replied to, the person who initiated the thread will see it in inbox.
</aside>
<h2 id='send-first-message'>Send First Message</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;user_id&gt;/send/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadCRUDApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread-create'</span><span class="p">),</span>
</code></pre></div>
<blockquote>
<p>This View can also take another url parameter - <code>thread_uuid</code> (see below)</p>
</blockquote>

<p>This endpoint sends a new message to a user by initiating new thread.</p>
<h3 id='route-parameters-2'>Route Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>user_id</td>
<td>true</td>
<td>The id of a user we want to send a message to.</td>
</tr>
</tbody></table>
<h3 id='body-parameters'>Body Parameters</h3>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
<th style="text-align: left">Method</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">message</td>
<td style="text-align: left">The content of the message</td>
<td style="text-align: left">POST</td>
</tr>
<tr>
<td style="text-align: left">subject</td>
<td style="text-align: left">The subject of the message</td>
<td style="text-align: left">POST</td>
</tr>
</tbody></table>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>GET http://localhost:8000/api/messages-drf/message/thread/&lt;user_id&gt;/send/</code></p>

<aside class="notics">
User can reply to a message that he recieved. This way he adds to a thread. When a message is replied to, the person who initiated the thread will see it in inbox.
</aside>
<h2 id='expand-on-thread'>Expand on thread</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;uuid&gt;/&lt;user_id&gt;/send/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">ThreadCRUDApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'thread-send'</span><span class="p">),</span>
</code></pre></div>
<blockquote>
<p>This is the same View that initiates a thread (see above).</p>
</blockquote>

<p>This endpoint sends a reply to an existing message.</p>
<h3 id='route-parameters-3'>Route Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uuid</td>
<td>true</td>
<td>The id of a thread we want to send a reply to.</td>
</tr>
<tr>
<td>user_id</td>
<td>true</td>
<td>The id of a user we want to send a message to.</td>
</tr>
</tbody></table>
<h3 id='body-parameters-2'>Body Parameters</h3>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
<th style="text-align: left">Method</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">message</td>
<td style="text-align: left">The content of the message</td>
<td style="text-align: left">POST</td>
</tr>
<tr>
<td style="text-align: left">subject</td>
<td style="text-align: left">The subject of the message</td>
<td style="text-align: left">POST</td>
</tr>
</tbody></table>
<h3 id='http-request-4'>HTTP Request</h3>
<p><code>GET http://localhost:8000/api/messages-drf/message/thread/&lt;uuid&gt;/&lt;user_id&gt;/send/</code></p>

<aside class="notics">
Sending first message or sending another message with URL with only `<user_id>` param always initiates a thread. This was we always have a UUID of a thread to reply to.
</aside>
<h2 id='edit-message'>Edit message</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">path</span><span class="p">(</span><span class="s">'message/thread/&lt;user_id&gt;/&lt;thread_id&gt;/edit/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">EditMessageApiView</span><span class="p">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'message-edit'</span><span class="p">),</span>
</code></pre></div>
<p>This endpoint edits a message from within a thread.</p>

<!-- Can we change thread_id to a message id? Is message or thread being actually edited here ? -->
<h3 id='route-parameters-4'>Route Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>thread_id</td>
<td>true</td>
<td>The id of a message we want to edit.</td>
</tr>
<tr>
<td>user_id</td>
<td>true</td>
<td>The id of a user we want to send a message to.</td>
</tr>
</tbody></table>

<!-- Thread_id or uuid ? -->
<h3 id='body-parameters-3'>Body Parameters</h3>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
<th style="text-align: left">Method</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">message</td>
<td style="text-align: left">The content of the message</td>
<td style="text-align: left">POST</td>
</tr>
<tr>
<td style="text-align: left">subject</td>
<td style="text-align: left">The subject of the message</td>
<td style="text-align: left">POST</td>
</tr>
</tbody></table>
<h3 id='http-request-5'>HTTP Request</h3>
<p><code>GET http://localhost:8000/api/messages-drf/message/thread/&lt;user_id&gt;/&lt;thread_id&gt;/edit/</code></p>
<h1 id='views'>Views</h1>
<p>Django Messages DRF comes initially with a set of views that allows you
to apply in your projects. All the views are in Django Rest Framework and allowing customization
up to a certain level.</p>

<p>All of the serializers are provided by the settings and allows overriding from there.</p>
<h2 id='inboxlistapiview'>InboxListApiView</h2>
<p>The main view for an inbox of a <strong><code>user</code></strong> where return an ordered list from the latest received to
the first.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">InboxListApiView</span><span class="p">(</span><span class="n">DjangoMessageDRFAuthMixin</span><span class="p">,</span> <span class="n">RequireUserContextView</span><span class="p">,</span> <span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    Returns the Inbox the logged in User
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">InboxSerializer</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">Pagination</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="n">inbox</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Thread</span><span class="p">.</span><span class="n">ordered</span><span class="p">(</span><span class="n">queryset</span><span class="p">)</span>
</code></pre></div><h3 id='tips'>Tips</h3>
<p>We use a custom <strong><code>Pagination</code></strong> object that adds some more details to the default Django
Pagination. You can have your own pagination object and override the default.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Custom Pagination Applied to the view
</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">pagination</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.views</span> <span class="kn">import</span> <span class="n">InboxListApiView</span>

<span class="k">class</span> <span class="nc">MyCustomPagination</span><span class="p">(</span><span class="n">pagination</span><span class="p">.</span><span class="n">PageNumberPagination</span><span class="p">):</span>
  <span class="c1"># Add custom pagination logic
</span>

<span class="k">class</span> <span class="nc">MyInboxListApiView</span><span class="p">(</span><span class="n">InboxListApiView</span><span class="p">):</span>
  <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">MyCustomPagination</span>

</code></pre></div>
<p>You can also override the serializer_class default using the same principle.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Custom Pagination Applied to the view
</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.views</span> <span class="kn">import</span> <span class="n">InboxListApiView</span>

<span class="k">class</span> <span class="nc">MyCustomSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
  <span class="c1"># Add custom serializer logic
</span>

<span class="k">class</span> <span class="nc">MyInboxListApiView</span><span class="p">(</span><span class="n">InboxListApiView</span><span class="p">):</span>
  <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">MyCustomSerializer</span>
</code></pre></div>
<p>Or combining both <strong><code>pagination</code></strong> and <strong><code>serializer_class</code></strong> in one.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Custom Pagination Applied to the view
</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">pagination</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.views</span> <span class="kn">import</span> <span class="n">InboxListApiView</span>

<span class="k">class</span> <span class="nc">MyCustomPagination</span><span class="p">(</span><span class="n">pagination</span><span class="p">.</span><span class="n">PageNumberPagination</span><span class="p">):</span>
  <span class="c1"># Add custom pagination logic
</span>
<span class="k">class</span> <span class="nc">MyCustomSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
  <span class="c1"># Add custom serializer logic
</span>

<span class="k">class</span> <span class="nc">MyInboxListApiView</span><span class="p">(</span><span class="n">InboxListApiView</span><span class="p">):</span>
  <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">MyCustomSerializer</span>
  <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">MyCustomPagination</span>
</code></pre></div><h2 id='threadlistapiview'>ThreadListApiView</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">ThreadListApiView</span><span class="p">(</span><span class="n">DjangoMessageDRFAuthMixin</span><span class="p">,</span> <span class="n">ThreadMixin</span><span class="p">,</span> <span class="n">RequireUserContextView</span><span class="p">,</span> <span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    Gets all the messages from a given thread
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ThreadSerializer</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_thread</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">)</span>

        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_context</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
</code></pre></div><h3 id='tips-2'>Tips</h3>
<p>The same logic for <strong>ThreadListApiView</strong> is the same applied for <a href="#tips">InboxListApiView</a> by
overriding the default <strong><code>serializer_class</code></strong>.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Custom Pagination Applied to the view
</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.views</span> <span class="kn">import</span> <span class="n">ThreadListApiView</span>

<span class="k">class</span> <span class="nc">MyCustomSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
  <span class="c1"># Add custom serializer logic
</span>

<span class="k">class</span> <span class="nc">MyThreadListApiView</span><span class="p">(</span><span class="n">ThreadListApiView</span><span class="p">):</span>
  <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">MyCustomSerializer</span>
</code></pre></div><h2 id='threadcrudapiview'>ThreadCRUDApiView</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">ThreadCRUDApiView</span><span class="p">(</span><span class="n">DjangoMessageDRFAuthMixin</span><span class="p">,</span> <span class="n">ThreadMixin</span><span class="p">,</span> <span class="n">RequireUserContextView</span><span class="p">,</span> <span class="n">APIView</span><span class="p">):</span>
    <span class="s">"""
    View that allows the reply of a specific message as well as the
    We will apply some pagination to return a list for the results and therefore

    1. This API gets or creates the Thread
    2. If a UUID is passed, then a Thread is validated and created but if only a user_id is
    passed, then it will create a new thread and start a conversation.
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ThreadReplySerializer</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Replies a mensage in given thread
        """</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_thread</span><span class="p">()</span> <span class="k">if</span> <span class="n">uuid</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_user</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">)</span>

        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">serializer</span><span class="p">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">subject</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'subject'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">thread</span><span class="p">.</span><span class="n">subject</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">thread</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">.</span><span class="n">new_message</span><span class="p">(</span>
                <span class="n">from_user</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">to_users</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'message'</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">.</span><span class="n">new_reply</span><span class="p">(</span><span class="n">thread</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'message'</span><span class="p">))</span>
            <span class="n">thread</span><span class="p">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">thread</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSerializer</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_context</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Flags a thread as deleted a thread from the system.
        To remove completely, another permanent view can be added to execute the action.
        """</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_thread</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">thread</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">)</span>

        <span class="n">thread</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">).</span><span class="n">update</span><span class="p">(</span><span class="n">deleted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
</code></pre></div><h3 id='tips-3'>Tips</h3>
<p>The same logic for <strong>ThreadCRUDApiView</strong> is the same applied for <a href="#tips">InboxListApiView</a> by
overriding the default <strong><code>serializer_class</code></strong>.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Custom Pagination Applied to the view
</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.views</span> <span class="kn">import</span> <span class="n">ThreadCRUDApiView</span>

<span class="k">class</span> <span class="nc">MyCustomSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
  <span class="c1"># Add custom serializer logic
</span>

<span class="k">class</span> <span class="nc">MyThreadCRUDApiView</span><span class="p">(</span><span class="n">ThreadCRUDApiView</span><span class="p">):</span>
  <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">MyCustomSerializer</span>
</code></pre></div><h2 id='editmessageapiview'>EditMessageApiView</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">EditMessageApiView</span><span class="p">(</span><span class="n">DjangoMessageDRFAuthMixin</span><span class="p">,</span> <span class="n">ThreadMixin</span><span class="p">,</span> <span class="n">RequireUserContextView</span><span class="p">,</span> <span class="n">APIView</span><span class="p">):</span>
    <span class="s">"""
    Edits a message sent from a user in a given thread
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">EDIT_MESSAGE_SERIALIZER</span>

    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">message_uuid</span><span class="p">):</span>
        <span class="s">"""
        Checks of the message exists
        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">uuid</span><span class="o">=</span><span class="n">message_uuid</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Message</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_serializer_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">().</span><span class="n">get_serializer_context</span><span class="p">()</span>
        <span class="n">context</span><span class="p">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">'thread'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_thead_by_id</span><span class="p">(),</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Edits a mensage in given thread.

        1. Gets the user_id from the URL.
        2. From the request.data gets the uuid of the message
        3. Validates
        4. Saves and returns
        """</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_user</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="p">.</span><span class="n">pk</span> <span class="o">==</span> <span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">pk</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">()</span>

        <span class="c1"># Get the instance of the message for a given user
</span>        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'uuid'</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">()</span>

        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serializer_class</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_context</span><span class="p">())</span>
        <span class="n">serializer</span><span class="p">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">serializer</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSerializer</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_context</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>

</code></pre></div><h3 id='general-tip'>General Tip</h3>
<ol>
<li>The views follow a similar structure and design everywhere but they can also be overwritten in a normal Django way.</li>
<li>Checkout the settings page to see how to override the variables.</li>
</ol>
<h1 id='mixins'>Mixins</h1>
<p>Mixins are a super useful tool when it comes to apply the DRY principles or share functionalities
across the platform.</p>
<h2 id='requireusercontextview'>RequireUserContextView</h2>
<p>A simplification of a <code>get_serializer_context</code> that can be applied on every serializer that needs
the user in the <code>context</code>.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">RequireUserContextView</span><span class="p">(</span><span class="n">GenericAPIView</span><span class="p">):</span>
    <span class="s">"""
    Handles with Generics of views
    """</span>
    <span class="k">def</span> <span class="nf">get_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Return the serializer instance that should be used for validating and
        deserializing input, and for serializing output.
        """</span>
        <span class="n">serializer_class</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_class</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">'context'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_serializer_context</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">serializer_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_serializer_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">().</span><span class="n">get_serializer_context</span><span class="p">()</span>
        <span class="n">context</span><span class="p">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">'request'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">request</span><span class="p">,</span>
            <span class="s">'user'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">user</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div><h2 id='threadmixin'>ThreadMixin</h2>
<p>All things common to a thread.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">ThreadMixin</span><span class="p">:</span>
    <span class="s">"""
    Everything related with a thread, is placed here.
    """</span>
    <span class="k">def</span> <span class="nf">get_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Gets the thread"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Thread</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'uuid'</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Thread</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Gets a User to whom which the message will be sent"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_user_model</span><span class="p">().</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'user_id'</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">get_user_model</span><span class="p">().</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_thead_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Gets a thread by id"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Thread</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">kwargs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'thread_id'</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">Thread</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span>
</code></pre></div><h2 id='currentthreaddefault'>CurrentThreadDefault</h2>
<p>Similar to <code>CurrentThreadDefault</code>, this mixin allows a similar behaviour to be injected into the
serializer fields as long as the <code>thread</code> is passed into the context.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">CurrentThreadDefault</span><span class="p">:</span>
    <span class="n">requires_context</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer_field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">serializer_field</span><span class="p">.</span><span class="n">context</span><span class="p">[</span><span class="s">'thread'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'%s()'</span> <span class="o">%</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span>
</code></pre></div><h2 id='examples'>Examples</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># serializers.py
</span><span class="kn">from</span> <span class="nn">django_messages.drf.mixins</span> <span class="kn">import</span> <span class="n">CurrentThreadDefault</span>


<span class="k">class</span> <span class="nc">MessageSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">allow_null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'blank'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"The message cannot be empty"</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">HiddenField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">serializers</span><span class="p">.</span><span class="n">CurrentUserDefault</span><span class="p">())</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">HiddenField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">CurrentThreadDefault</span><span class="p">())</span>
</code></pre></div><h1 id='models'>Models</h1>
<p>We decided to use UUIDs to make harder to make associations by using it but not using as primary
key.</p>
<h2 id='thread'>Thread</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">Thread</span><span class="p">(</span><span class="n">AuditModel</span><span class="p">):</span>
    <span class="s">"""Main model where a thread is created. This model only contains a subject
    and a ManyToMany relationship with the users.

    Django by default creates an 'invisible' model when ManyToMany is declared
    but we can override the default and point to our own model.

    A `uuid` field is declared as a way to
    """</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">through</span><span class="o">=</span><span class="s">"UserThread"</span><span class="p">)</span>
</code></pre></div>
<p>Thread is the main model and some sort of source of truth.</p>
<h3 id='functions'>Functions</h3><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">inbox</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
      <span class="s">"""Returns the inbox of a given user"""</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">userthread__user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">userthread__deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">deleted</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
      <span class="s">"""Returns the deleted messages of a given user"""</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">userthread__user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">userthread__deleted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">unread</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
      <span class="s">"""Returns all the unread messages of a given user"""</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span>
          <span class="n">userthread__user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
          <span class="n">userthread__deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
          <span class="n">userthread__unread</span><span class="o">=</span><span class="bp">True</span>
      <span class="p">)</span>

  <span class="o">@</span><span class="nb">property</span>
  <span class="k">def</span> <span class="nf">first_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="s">"""Returns the first message"""</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="nb">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

  <span class="o">@</span><span class="nb">property</span>
  <span class="k">def</span> <span class="nf">latest_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="s">"""Returs the last message"""</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">"-sent_at"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">ordered</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
      <span class="s">"""
      Returns the iterable ordered the correct way, this is a class method
      because we don"t know what the type of the iterable will be.
      """</span>
      <span class="n">objs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span>
      <span class="n">objs</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="p">.</span><span class="n">latest_message</span><span class="p">.</span><span class="n">sent_at</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">objs</span>

  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">get_thread_users</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
      <span class="s">"""Returns all the users from the thread"""</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">users</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">earliest_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_to_exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="s">"""
      Returns the earliest message of the thread

      :param user_to_exclude: Returns a list of the messages excluding a given user. This is
      particulary useful for showing the earliest message sent in a thread between two different
      users
      """</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">user_to_exclude</span><span class="p">).</span><span class="n">earliest</span><span class="p">(</span><span class="s">'sent_at'</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">Message</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
          <span class="k">return</span>

  <span class="k">def</span> <span class="nf">last_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Returns the latest message of the thread. Is the reverse of the `earliest_message`
        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">latest</span><span class="p">(</span><span class="s">'sent_at'</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Message</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span>

  <span class="k">def</span> <span class="nf">last_message_excluding_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_to_exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="s">"""
      Returns the latest message of the thread. Is the reverse of the `earliest_message`

      :param user_to_exclude: Returns a list of the messages excluding a given user. This is
      particulary useful for showing the latest message sent in a thread between two different
      users.
      """</span>
      <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">user_to_exclude</span><span class="p">:</span>
              <span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="p">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">user_to_exclude</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">queryset</span><span class="p">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'sent_at'</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">Message</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
          <span class="k">return</span>

  <span class="k">def</span> <span class="nf">unread_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
      <span class="s">"""
      Gets the unread messages from User in a given Thread.

      Example:
          '''
          t = Thread.objects.first()
          user = User.objects.first()
          unread = t.uread_messages(user)
          '''
      """</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unread</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">is_user_first_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
      <span class="s">"""
      Checks if the user started the thread
      :return: Bool
      """</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="n">earliest</span><span class="p">(</span><span class="s">'sent_at'</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">Message</span><span class="p">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">False</span>
      <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">pk</span> <span class="o">==</span> <span class="n">user</span><span class="p">.</span><span class="n">pk</span><span class="p">)</span>
</code></pre></div><h2 id='userthread'>UserThread</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">UserThread</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""Maps the user and the thread. This model was used to override the default ManyToMany
    relationship table generated by django.
    """</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Thread</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="n">unread</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">deleted</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">()</span>
</code></pre></div>
<p>This model is a substitution of the default generated by ManyToMany of Django.</p>
<h2 id='message'>Message</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    Message model where creates threads, user threads and mapping between them.
    """</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Thread</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"messages"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">"sent_messages"</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">sent_at</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="p">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
</code></pre></div><h3 id='functions-2'>Functions</h3><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">new_reply</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
      <span class="s">"""
      Create a new reply for an existing Thread. Mark thread as unread for all other participants,
      and mark thread as read by replier. We want an atomic operation as we can't afford having
      lost data between tables and causing problems with data integrity.
      """</span>
      <span class="k">with</span> <span class="n">transaction</span><span class="p">.</span><span class="n">atomic</span><span class="p">():</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">msg</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>
              <span class="n">thread</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">).</span><span class="n">update</span><span class="p">(</span><span class="n">deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unread</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
              <span class="n">thread</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">).</span><span class="n">update</span><span class="p">(</span><span class="n">deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unread</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
              <span class="n">message_sent</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">cls</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
          <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="n">log</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
              <span class="k">return</span>
      <span class="k">return</span> <span class="n">msg</span>

  <span class="o">@</span><span class="nb">classmethod</span>
  <span class="k">def</span> <span class="nf">new_message</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">from_user</span><span class="p">,</span> <span class="n">to_users</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
      <span class="s">"""
      Create a new Message and Thread. Mark thread as unread for all recipients, and
      mark thread as read and deleted from inbox by creator. We want an atomic operation as we
      also can't afford having lost data between tables and causing problems with data integrity.
      """</span>
      <span class="k">with</span> <span class="n">transaction</span><span class="p">.</span><span class="n">atomic</span><span class="p">():</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">)</span>
              <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">to_users</span><span class="p">:</span>
                  <span class="n">thread</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unread</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
              <span class="n">thread</span><span class="p">.</span><span class="n">userthread_set</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">from_user</span><span class="p">,</span> <span class="n">deleted</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">unread</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
              <span class="n">msg</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">from_user</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>
              <span class="n">message_sent</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">cls</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">,</span> <span class="n">reply</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
          <span class="k">except</span> <span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="n">log</span><span class="p">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
              <span class="k">return</span>
      <span class="k">return</span> <span class="n">msg</span>

  <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">thread</span><span class="p">.</span><span class="n">get_absolute_url</span><span class="p">()</span>
</code></pre></div><h2 id='tips-4'>Tips</h2>
<p>When creating a new message, the default behavior is calling the <code>new_message</code> or <code>reply_message</code>,
depending of the type.</p>
<h1 id='pagination'>Pagination</h1>
<p>Two custom pagination classes are provided for the application. The information was gathered from
<a href="https://gist.github.com/tarsil/6255492c273b682bb329ba3f8d623754">here</a>.</p>
<h2 id='pagination-class'>Pagination class</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">Pagination</span><span class="p">(</span><span class="n">pagination</span><span class="p">.</span><span class="n">PageNumberPagination</span><span class="p">):</span>
    <span class="s">"""
    Custom paginator for REST API responses
    'links': {
               'next': next page url,
               'previous': previous page url
            },
            'count': number of records fetched,
            'total_pages': total number of pages,
            'next': bool has next page,
            'previous': bool has previous page,
            'results': result set
    })
    """</span>

    <span class="k">def</span> <span class="nf">get_paginated_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
            <span class="s">'links'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'next'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_next_link</span><span class="p">(),</span>
                <span class="s">'previous'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_previous_link</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s">'pagination'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'previous_page'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">number</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s">'current_page'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">number</span><span class="p">,</span>
                <span class="s">'next_page'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">has_next</span><span class="p">()</span> <span class="k">else</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s">'page_size'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page_size</span>
            <span class="p">},</span>
            <span class="s">'count'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">paginator</span><span class="p">.</span><span class="n">count</span><span class="p">,</span>
            <span class="s">'total_pages'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">paginator</span><span class="p">.</span><span class="n">num_pages</span><span class="p">,</span>
            <span class="s">'next'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">has_next</span><span class="p">(),</span>
            <span class="s">'previous'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">has_previous</span><span class="p">(),</span>
            <span class="s">'results'</span><span class="p">:</span> <span class="n">data</span>
        <span class="p">})</span>
</code></pre></div><h2 id='simplepagination'>SimplePagination</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">SimplePagination</span><span class="p">(</span><span class="n">pagination</span><span class="p">.</span><span class="n">PageNumberPagination</span><span class="p">):</span>
    <span class="s">"""
    Custom paginator for REST API responses
    """</span>
    <span class="k">def</span> <span class="nf">get_paginated_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
            <span class="s">'records_filtered'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">page</span><span class="p">.</span><span class="n">paginator</span><span class="p">.</span><span class="n">count</span><span class="p">,</span>
            <span class="s">'data'</span><span class="p">:</span> <span class="n">data</span>
        <span class="p">})</span>
</code></pre></div><h1 id='permissions'>Permissions</h1>
<p>A small set of permissions are set in the app to make sure the data is safer and secure and those
can be also extended.</p>
<h2 id='accessmixin'>AccessMixin</h2>
<p>Base class of all permission mixins of Django Messages DRF. Adds an extension for the permissions of
Django Rest Framework where you can now append into a list instead of repeating on every class.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">AccessMixin</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">DjangoMessageDRFAuthMeta</span><span class="p">):</span>
    <span class="s">"""
    Django rest framework doesn't append permission_classes on inherited models which can cause
    issues when it comes to call an API programmatically, this way we create a metaclass that will
    read from a property custom from our subclasses and will append to the default
    `permission_classes` on the subclasses of AccessMixin.
    """</span>
    <span class="k">pass</span>
</code></pre></div><h2 id='djangomessagedrfauthmixin'>DjangoMessageDRFAuthMixin</h2>
<p>Base class of all views of the application and sets the principle that every view inheriting from
this will validate the user authentication.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">DjangoMessageDRFAuthMixin</span><span class="p">(</span><span class="n">AccessMixin</span><span class="p">,</span> <span class="n">APIView</span><span class="p">):</span>
    <span class="s">"""
    Base APIView requiring login credentials to access it from the inside of the platform
    Or via request (if known)
    """</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="s">"""
        Checks if the views contain the `permissions` attribute and overrides the
        `permission_classes`.
        """</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">permission_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">permissions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">pagination_class</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rest_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">.</span><span class="n">REST_FRAMEWORK</span>
            <span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
                <span class="n">rest_settings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">page_size</span> <span class="o">=</span> <span class="n">rest_settings</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'PAGE_SIZE'</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">pagination_class</span><span class="p">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="n">page_size</span>

</code></pre></div><h2 id='examples-2'>Examples</h2>
<p>Using the <strong><code>DjangoMessageDRFAuthMixin</code></strong> as a base we can now start creating our own views without
thinking about replicating the <code>permission_classes</code>.</p>
<h3 id='with-djangomessagedrfauthmixin'>With DjangoMessageDRFAuthMixin</h3><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>

<span class="kn">from</span> <span class="nn">django_messages_drf.permissions</span> <span class="kn">import</span> <span class="n">DjangoMessageDRFAuthMixin</span>
<span class="kn">from</span> <span class="nn">my_app.permissions</span> <span class="kn">import</span> <span class="n">MyPermission</span>


<span class="k">class</span> <span class="nc">MyCustomView</span><span class="p">(</span><span class="n">DjangoMessageDRFAuthMixin</span><span class="p">,</span> <span class="n">APiView</span><span class="p">):</span>
  <span class="s">"""
  My Custom view that will do things
  """</span>
  <span class="n">permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission</span><span class="p">]</span>

</code></pre></div>
<p>Importing the <code>APIView</code> is optional since the <code>DjangoMessageDRFAuthMixin</code> already implements it.</p>

<p>Behind the scenes, Django Messages DRF is appending the <code>permissions</code> to <code>permission_classes</code> of
Django Rest Framework, which means that if we query for the <code>permission_classes</code> we would have:</p>
<div class="highlight"><pre class="highlight shell tab-shell"><code>permission_classes <span class="o">=</span> <span class="o">[</span>IsAuthenticated, MyPermission]
</code></pre></div><h3 id='without-djangomessagedrfauthmixin'>Without DjangoMessageDRFAuthMixin</h3><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>

<span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">IsAuthenticated</span>
<span class="kn">from</span> <span class="nn">my_app.permissions</span> <span class="kn">import</span> <span class="n">MyPermission</span>


<span class="k">class</span> <span class="nc">BaseView</span><span class="p">(</span><span class="n">APiView</span><span class="p">):</span>
  <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">MyCustomView</span><span class="p">(</span><span class="n">BaseView</span><span class="p">):</span>
  <span class="s">"""
  My Custom view that will do things
  """</span>
  <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyPermission</span><span class="p">]</span>

</code></pre></div>
<p>This won&#39;t have the same result as the <code>DjangoMessageDRFAuthMixin</code> because what is doing is actually
reassigning the <code>permission_classes</code> from the <code>BaseView</code> to the <code>MyCustomView</code>.</p>
<h1 id='serializers'>Serializers</h1>
<p>Django Messages DRF like with the views, also comes with a set of serializers that allows you
to apply in your project but you can and should build your own with your own use cases.</p>

<p>The way the serializers are built are the default ones from Django Rest Framework.</p>
<h2 id='inbox-2'>Inbox</h2>
<p>A simple example for an inbox serializer.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">InboxSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="s">"""
    Serializer for the inbox.
    """</span>
    <span class="n">sent_at</span> <span class="o">=</span> <span class="n">serializers</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s">'first_message.sent_at'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">useruser</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Thread</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'uuid'</span><span class="p">,</span> <span class="s">'subject'</span><span class="p">,</span> <span class="s">'sent_at'</span><span class="p">)</span>

</code></pre></div><h2 id='sender'>Sender</h2>
<p>A sender for Django Messages DRF is a Django <strong><code>user</code></strong> and can be whatever you decided that u.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">SenderSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">)</span>
</code></pre></div><h1 id='serializer-settings'>Serializer Settings</h1>
<p>Django Messages DRF allows overriding some settings for the views, which means, instead of creating
a new view just to apply your own serializer, you can simply override the setting and
Django Messages DRF will apply it on the current views.</p>

<p>None of the below settings are required to be added to your <code>settings.py</code>. This is only if
you wish to override the current defaults.</p>
<h2 id='overriding'>Overriding</h2>
<p>In your <strong><code>settings.py</code></strong>.</p>

<table><thead>
<tr>
<th style="text-align: left">Setting Name</th>
<th style="text-align: left">View</th>
<th style="text-align: left">Default</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>DJANGO_MESSAGES_DRF_INBOX_SERIALIZER</strong></td>
<td style="text-align: left">InboxListApiView</td>
<td style="text-align: left">InboxSerializer</td>
</tr>
<tr>
<td style="text-align: left"><strong>DJANGO_MESSAGES_DRF_THREAD_SERIALIZER</strong></td>
<td style="text-align: left">ThreadListApiView</td>
<td style="text-align: left">ThreadSerializer</td>
</tr>
<tr>
<td style="text-align: left"><strong>DJANGO_MESSAGES_DRF_MESSAGE_SERIALIZER</strong></td>
<td style="text-align: left">ThreadCRUDApiView</td>
<td style="text-align: left">ThreadReplySerializer</td>
</tr>
<tr>
<td style="text-align: left"><strong>DJANGO_MESSAGES_DRF_EDIT_MESSAGE_SERIALIZER</strong></td>
<td style="text-align: left">EditMessageApiView</td>
<td style="text-align: left">EditMessageSerializer</td>
</tr>
</tbody></table>
<h2 id='usage'>Usage</h2>
<p>Overriding is based on <code>import_string</code> from your <strong><code>settings.py</code></strong>.</p>
<h3 id='examples-3'>Examples</h3><div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># settings.py
</span>
<span class="n">DJANGO_MESSAGES_DRF_INBOX_SERIALIZER</span> <span class="o">=</span> <span class="s">'myapp.serializers.MyCustomInboxSerializer'</span>
<span class="n">DJANGO_MESSAGES_DRF_THREAD_SERIALIZER</span> <span class="o">=</span> <span class="s">'myapp.serializers.MyCustomThreadSerializer'</span>
</code></pre></div>
<p>If none of the settings is overridden or is <strong><code>None</code></strong> , then it will default to the original.</p>
<h1 id='behaviour-settings'>Behaviour Settings</h1>
<p>Django Messages DRF allows overriding some behaviours.</p>
<h2 id='overriding-2'>Overriding</h2>
<p>In your <strong><code>settings.py</code></strong>.</p>

<table><thead>
<tr>
<th style="text-align: left">Setting Name</th>
<th style="text-align: left">Behaviour</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Default</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>DJANGO_MESSAGES_MARK_NEW_THREAD_MESSAGE_AS_DELETED</strong></td>
<td style="text-align: left">Mark the first message sent as deleted</td>
<td style="text-align: left">Boolean</td>
<td style="text-align: left">True</td>
</tr>
</tbody></table>
<h1 id='utils'>Utils</h1>
<p>Some useful utils are provided with the project to make it easier to reuse across.</p>
<h2 id='auditmodel'>AuditModel</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">AuditModel</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""A common audit model for tracking"""</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">modified_at</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</code></pre></div>
<p>Adding the <strong><code>AuditModel</code></strong> to a model will add an audit trailing to it making it easier
to filter by dates.</p>

<p>This can be extended and add more information such as <strong><code>created_by</code></strong> or <strong><code>modified_by</code></strong>
where those are users of the application.</p>
<h1 id='signals'>Signals</h1><h2 id='message-sent'>Message sent</h2>
<p>We only provide one signal at the moment. This signal fires off after every message.</p>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="n">message_sent</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">providing_args</span><span class="o">=</span><span class="p">[</span><span class="s">"message"</span><span class="p">,</span> <span class="s">"thread"</span><span class="p">,</span> <span class="s">"reply"</span><span class="p">])</span>
</code></pre></div>
<!-- Creating new threads also fires it off? -->
<h1 id='release-notes'>Release Notes</h1><h2 id='1-0-6'>1.0.6</h2>
<ul>
<li>Preparing to drop support for python 3.6.</li>
<li>Fix <code>providing_args</code> from signals as it is deprecated in Django 4.</li>
</ul>
<h2 id='1-0-5'>1.0.5</h2>
<ul>
<li>Added <code>id</code> field to the ThreadSerializer.</li>
</ul>
<h2 id='1-0-4'>1.0.4</h2>
<ul>
<li><a href="https://github.com/tarsil/django-messages-drf/pull/10">Bugfix #10</a>. Thank you <a href="https://github.com/kamikaz1k">kamikaz1k</a></li>
<li><a href="https://github.com/tarsil/django-messages-drf/pull/9">Bugfix #9</a>. Thank you <a href="https://github.com/kamikaz1k">kamikaz1k</a></li>
</ul>
<h2 id='1-0-3'>1.0.3</h2><h3 id='added'>Added</h3>
<ul>
<li>Settings to override the serializers on the views by using a custom.</li>
<li><code>EditMessageApiView</code> allowing editing a message sent from a user of a given thread.</li>
<li><code>CurrentThreadDefault</code> similar to <code>CurrentUserDefault</code> from Django Rest Framework but for threads.</li>
</ul>
<h3 id='fixed'>Fixed</h3>
<ul>
<li>Show sender when a message sent is from the same sender and receiver - <a href="https://github.com/tarsil/django-messages-drf/issues/5">Issue</a></li>
<li>Issue with <code>display_name</code> for InboxSerializer - <a href="https://github.com/tarsil/django-messages-drf/issues/4">Issue</a>.</li>
<li><code>ThreadCRUDApiView</code> <code>post</code> where wasn&#39;t using the data from the serializer.</li>
</ul>
<h2 id='1-0-2'>1.0.2</h2><h3 id='added-2'>Added</h3>
<ul>
<li>Support for python 3.9</li>
<li>CircleCI config</li>
</ul>
<h3 id='fixed-2'>Fixed</h3>
<ul>
<li>Tests naming conflicts.</li>
<li>Migration issues.</li>
</ul>
<h3 id='updated'>Updated</h3>
<ul>
<li>README.</li>
</ul>
<h2 id='1-0-0'>1.0.0</h2>
<ul>
<li>Initial release</li>
</ul>
<h2 id='license'>License</h2>
<p>Copyright (c) 2020-present Tiago Silva and contributors under the <a href="https://opensource.org/licenses/MIT">MIT license</a>.</p>
<h1 id='errors'>Errors</h1>
<aside class="notice">
If you notice any errors when running the package, please let us know.
</aside>

<p>Mainterners:</p>

<p><a target='_blank' href='https://tarsild.io'>Tarsil</a></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
